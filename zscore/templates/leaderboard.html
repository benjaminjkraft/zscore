{% extends "frame.html" %}

{% block content %}
{% load datetime_utils %}
{% load sleep_tags %}
{% load graphs %}
{% load gravatar %}
{% if group %}
<h1> {{group.name}} leaderboard </h1>
{% else %}
<h1> Leaderboard </h1>
{% endif %}

{{number}} {% if group %}{{group.name}} members {% else %} zScore users {% endif %} have slept a total of {{total|printYDHM}}!

<table>
    <tr>
        <td>Rank</td>
        <td colspan="2">Username</td>
        <td><a href="?sort=zScore">zScore</a></td>
        <td><a href="?sort=zPScore">zPScore</a></td>
        <td><a href="?sort=avg">avg</a></td>
        <td><a href="?sort=avgSqrt">avgSqrt</a></td>
        <td><a href="?sort=avgLog">avgLog</a></td>
        <td><a href="?sort=avgRecip">avgRecip</a></td>
        <td><a href="?sort=stDev">stDev</a></td>
        <td><a href="?sort=posStDev">posStDev</a></td>
        <td><a href="?sort=idealDev">idealDev</a></td>
	<td><a href="?sort=consistent">consistent</a></td>
    </tr>
  {% for s in top %}
  <tr {% if s.user.id == request.user.id %} style="background-color:#DEF2FF" {% endif %}>
    <td> {{s.rank}} </td>
    <td> {% gravatar request.user s.user 20 1 %}
    <td> {% displayUser s.user.displayName %} </td>
    <td> {{s.zScore|printHHMM}} </td>
    <td> {{s.zPScore|printHHMM}} </td>
    <td> {{s.avg|printHHMM}} </td>
    <td> {{s.avgSqrt|printHHMM}} </td>
    <td> {{s.avgLog|printHHMM}} </td>
    <td> {{s.avgRecip|printHHMM}} </td>
    <td> {{s.stDev|printHHMM}} </td>
    <td> {{s.posStDev|printHHMM}} </td>
    <td> {{s.idealDev|printHHMM}}</td>
    <td> {{s.consistent}} </td>
  </tr>
  {% endfor %}
</table>

Congratulations to {% displayUser recentWinner.user.displayName %} ({% gravatar request.user recentWinner.user 20 1 %}) for sleeping the most ({{recentWinner.time|printDHHMM}}) in the last 3 days!


<h3>Notes</h3>
<p>
The leaderboard shows users with at least 3 days of sleep, including at least one of the last 5 days. <i>It now ranks by exponentially-weighted decaying scores</i>, that is, today is weighted at 1, yesterday at some factor &lambda;, the day before that at &lambda;<sup>2</sup>, and so on.  Hidden users do not count towards rank.  The number of users at the top counts all users with at least 1 day of sleep.
</p>
<p>
Graphs have moved <a href="/graphs/">here</a>.
</p>


{% endblock %}
